% 
% Package pour l'{\'e}criture de cours 
%
\NeedsTeXFormat{LaTeX2e}[1998/06/01]
\ProvidesPackage{course}

% Langage {\`a} utiliser, par d{\'e}faut le fran{\c c}ais.

\newif\ifusefrenchlanguage
\usefrenchlanguagetrue

% Encodage, par d{\'e}faut latin1, mais changeable avec
% l'option utf8

\newif\ifuseunicode
\newif\ifnotesdecours
\newif\iftwocolumn
\newif\iftransparents
\newif\ifhandout
\newif\ifqrcode
\newif\ifsolutions
\newif\iflistings

\DeclareOption{english}{\usefrenchlanguagefalse}
\DeclareOption{utf8}{\useunicodetrue}
\DeclareOption{cours}{\notesdecourstrue}
\DeclareOption{twocolumn}{\twocolumntrue}
\DeclareOption{beamer}{\transparentstrue}
\DeclareOption{handout}{\handouttrue}
\DeclareOption{qr}{\qrcodetrue}
\DeclareOption{solutions}{\solutionstrue}
\DeclareOption{listings}{\listingstrue}

\ProcessOptions*

% Include du package calculant l'ann{\'e}e universitaire courante en
% fonction du mois de compilation

\RequirePackage{yearcomputation} 
\RequirePackage{xcolor}
\RequirePackage{comment}


\ifsolutions
\includecomment{solution}
\else
\iftransparents\else
\excludecomment{solution}
\fi
\fi

\iftransparents
  \ifhandout
    \documentclass[handout]{beamer}
  \else
    \documentclass[beamer]{beamer}
  \fi
  \usepackage{iritslides}
\else
  \ifnotesdecours
    \documentclass[a4paper]{book}

  \AtBeginDocument{%
    \longheader
    
    \tableofcontents
    \newpage
  }%
  \else
    \iftwocolumn
      \documentclass[a4paper,twocolumn]{article}
    \else
      \documentclass[12pt,a4paper]{article}
    \fi
    \newcounter{chapter}
  \fi
  \usepackage[margin=2cm]{geometry}
  % Gestion des figures
  \renewcommand{\topfraction}{1} % max fraction of floats at top
  \renewcommand{\bottomfraction}{1} % max fraction of floats at bottom
  % Parameters for TEXT pages (not float pages):
  \setcounter{topnumber}{4} 
  \setcounter{bottomnumber}{4}
  \setcounter{totalnumber}{8} % 2 may work better
  \setcounter{dbltopnumber}{4} % for 2-column pages
  \renewcommand{\dbltopfraction}{1} % fit big float above 2-col. text
  \renewcommand{\textfraction}{0} % allow minimal text w. figs
  % Parameters for FLOAT pages (not text pages):
  \renewcommand{\floatpagefraction}{1} % require fuller float pages
  % N.B.: floatpagefraction MUST be less than topfraction !!
  \renewcommand{\dblfloatpagefraction}{1} % require fuller float pages
  % remember to use [htp] or [htpb] for placement
\fi


\usepackage[framemethod=tikz]{mdframed}

% Ecriture de codes 
\iflistings
  \RequirePackage{langages}
\fi

% Definitions mathematiques

\RequirePackage{maths}

% Urls
\RequirePackage{url}
\urlstyle{sf}

% Utilisation des couleurs

\colorlet{orange}{red!70!yellow}% mes petites couleurs que j'aime bien
\colorlet{mauve}{blue!70!red}
\colorlet{brouge}{red!70!blue}

% Inclusion de babel suivant le langage utilis{\'e}. On
% en profile pour inclure le package varioref, qui permet
% des r{\'e}f{\'e}rences {\`a} des pages

\ifusefrenchlanguage
   \RequirePackage[french]{babel}
   \usepackage[french]{varioref}
\else
   \usepackage[english]{varioref}
\fi
% Choix de l'encodage des fichiers source.

\ifuseunicode
   \RequirePackage[utf8]{Myencodings}
\else
   \RequirePackage{Myencodings}
\fi

% Compilation des primitives pdf
\RequirePackage{pdftexcmds}
% D{\'e}finition de labels customis{\'e}s

\def\setlabel#1#2{\expandafter\gdef\csname the#1\endcsname{#2}}

% Inclusion du package d{\'e}finissant la macro \useformation
% \useformation pcp (L2 PCP:Informatique)

\RequirePackage{formations}

% Inclusion du package de d{\'e}finition des exercices. Il doit {\^e}tre inclu
% avant celui de d{\'e}finition des en-t{\^e}tes pour que td,tp,
% etc. remettent le compteur d'exercice {\`a} 0.

\RequirePackage{exercices}

% Inclusion du package de d{\'e}finition des en-t{\^e}tes

\RequirePackage{entetes}


% Mise en pages






\RequirePackage{graphicx}            % for including graphics
\RequirePackage{algorithm} % environnement algorithme
%\usepackage{exemple} % environnement pour les exemples
\renewcommand{\ALG@name}{Programme}
\renewcommand{\listalgorithmname}{Liste des \ALG@name s}
\newcommand{\mref}[1]{\ref{#1}~\vpageref{#1}}
\newenvironment{flist}[1][--]{%
  \begin{list}{#1}{%
      \setlength{\itemsep}{-3pt}%
      \setlength{\topsep}{0pt}%
      \setlength{\partopsep}{0pt}%
      \setlength{\leftmargin}{.5cm}%
    }%
  }%
  {%
  \end {list}%
}

\RequirePackage[absolute]{textpos}
\setlength{\TPHorizModule}{1cm}
\setlength{\TPVertModule}{\TPHorizModule}

\newenvironment{cours}{%
  \begin{list}{}{\rightmargin 1em\leftmargin 1em}%
  \item[]\underline{\bf Cours}
  \item[]\it
}{%
\end{list}
}
\surroundwithmdframed[outerlinewidth=0.4pt,
  innerlinewidth=0.4pt,
  middlelinewidth=1pt,
  middlelinecolor=white,
  bottomline=false,topline=false,rightline=false]{cours}



\ifqrcode
\RequirePackage{auto-pst-pdf}
\RequirePackage{pst-barcode}
\def\chapitreQRcode#1{\begin{textblock}{2}(14.5,1.5)
  \begin{pspicture}(2cm,2cm) \psbarcode%
    {http\string:\string/\string/www\string.irit\string.fr\string/\string~\string
      Yannick\string.\string Chevalier\string/\string Cours\string/\string Cours\string-\string C\string/chap#1\string.pdf}%
    {version=10 eclevel=L}%
    {qrcode}
  \end{pspicture}
\end{textblock}}
\else
\def\chapitreQRcode#1{}
\fi

