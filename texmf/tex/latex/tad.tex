\NeedsTeXFormat{LaTeX2e}[1998/06/01]
\ProvidesPackage{tad}

\newif\ifTadStyleC
\newif\ifTadStyleCaml
\newif\ifTadStyleStd

\ifTadStyleStdtrue
\DeclareOption{caml}{\ifTadStyleCamltrue\ifTadStyleStdfalse\ifTadStyleCfalse}
\DeclareOption{C}{\ifTadStyleCtrue\ifTadStyleStdfalse\ifTadStyleCamlfalse}
\DeclareOption{std}{\ifTadStyleStdtrue\ifTadStyleCfalse\ifTadStyleCamlfalse}

\ProcessOptions*

% Fonte pour les mots-clefs et style g{\'e}n{\'e}ral
\newcommand{\tadkw}[1]{\mbox{\sc{} #1}}
\newcommand{\tadMod}[1]{\uppercase{#1}}


% Commentaires

\ifTadStyleC
\newcommand{\tadCommentSignBegin}{/*}
\newcommand{\tadCommentSignEnd}{*/}
\fi

\ifTadStyleCaml
\newcommand{\tadCommentSignBegin}{(*}
\newcommand{\tadCommentSignEnd}{*)}
\fi
\ifTadStyleStd
\newcommand{\tadCommentSignBegin}{\_}
\newcommand{\tadCommentSignEnd}{}
\fi

\newcommand{\tadComment}[1]{\text{\tt\tadCommentSignBegin~#1~\tadCommentSignEnd}}


% Macros pour les d{\'e}finitions de mots-clefs

\makeatletter

\def\maketadkw#1#2{%
  \expandafter\def\csname #1\endcsname%
  {\tadkw{#2}\xspace}
}
\def\make@math@tadkw#1{\maketadkw{#1}{#1}}
\def\MakeTADkw#1{\make@math@iterator{#1}{tadkw}}


\makeatother


\MakeTADkw{Type,epyT,Variables,avec,Sortes,Axiomes}
\maketadkw{etend}{{\'e}tend}
\maketadkw{renomme}{renomm{\'e}}
\maketadkw{Operateurs}{Op{\'e}rateurs}


% Environnements pour les specifications de type

\newenvironment{type}[1]{%
\begin{trivlist}
\item \Type \tadMod{#1}
}{%
\item \epyT
\end{trivlist}}

\newcommand{\sortes}[1]{\item \Sortes \ensuremath{#1}}
\newcommand{\extensionde}[1]{\item \etend #1}
\newcommand{\renommage}[2]{\avec #1 \renomme #2, }

\makeatletter
\def\make@assoc@renommage@aux(#1->#2){\renommage{#1}{#2}}
\def\make@assoc@renommage#1{\expandafter\make@assoc@renommage@aux#1}
\def\make@list@renommage#1{\@for\p@arg:=#1\do{%
\edef\arg{\expandafter\@firstofone\p@arg}
\make@assoc@renommage\p@arg
}}
\newcommand{\module}[2][]{%
\ifthenelse{\equal{#1}{}}{\tadMod{#2},}{%
\item \hspace*{2.5em}\tadMod{#2} \make@list@renommage{#1}
}}
\makeatother

% Sp{\'e}cification de types -- Operateurs

\newenvironment{operateurs}{
\item \Operateurs
\begin{displaymath}
\begin{array}{r@{~:~}r@{\ensuremath{\rightarrow}}l}}{
\end{array}
\end{displaymath}}
\newcommand{\newTADop}[3]{\ifthenelse{\equal{#2}{}}{#1&\emptyset&#3}{#1&#2&#3}\\}

% Sp{\'e}cification de types -- Variables

\newcommand{\variables}[1]{\item \Variables \ensuremath{#1}}

% Sp{\'e}cification de types -- Axiomes

\newenvironment{axiomes}[1][]{\item \Axiomes #1
\begin{displaymath}
\begin{array}{lc@{\hspace*{2em}}p{0.5\linewidth}}
}{%
\end{array}
\end{displaymath}}
   % arguments optionels: 1 -> commentaire, 2 -> nom, 3 -> axiome
\newcommand{\newTADax}[2][]{\ifthenelse{\equal{#1}{}}{#2&\\}{#2&\tadComment{#1}\\}}
   % Types d'axiomes
\newcommand{\TADeq}[3][]{#1&#2=#3}
\newcommand{\TADHorn}[3][]{#1&#2\rightarrow #3}
\newcommand{\TADcoer}[2]{(#1:#2)}

