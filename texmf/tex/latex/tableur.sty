\NeedsTeXFormat{LaTeX2e}[1998/06/01]
\ProvidesPackage{tableur}
\RequirePackage{rotating}
\RequirePackage{pdflscape}
\RequirePackage{longtable}



\newcount\c@j
\newcount\c@i

\newcount\c@candnum
\c@candnum 0 \relax

\newcount\c@nbfields
\c@nbfields 0 \relax


\newtoks\tableaudescription
\tableaudescription={|}


\def\tableur@init{%
  \global\c@candnum 0 \relax
  \global\c@nbfields 0 \relax
  \global\tableaudescription={|}%
}

\tableur@init

% Redefinition des loops
\long\def\loop#1\repeat{\iterate\gobbleone{#1}}
\long\def\iterate\gobbleone#1{#1\expandafter\iterate\fi\gobbleone{#1}}
\long\def\gobbleone#1{}



\def\newfield #1#2{%
  \advance\c@nbfields 1\relax
  \tableaudescription=\expandafter{\the\tableaudescription #2|}
  \expandafter\gdef\csname nbfield\romannumeral\c@nbfields\endcsname{#1}
  \expandafter\gdef\csname #1\endcsname##1{%
    \expandafter\gdef\csname #1\romannumeral\c@candnum\endcsname{##1}%
  }%
}

\def\record{%
%  \ifnum \c@candnum > 0
%   \end{description}
%  \fi
  \advance\c@candnum 1\relax
%  \begin{description}
}


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%
% Pr{\'e}sentation des records en un tableau
%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

% Premi{\`e}re ligne
\newtoks\tableauhead
% Lignes de contenu
\newtoks\tableaubody



\def\computetableauhead{%
  \global\c@i 0\relax
  \global\tableauhead={\hline}%
  \loop
  \advance\c@i 1\relax
  \edef\currentheader{\the\tableauhead \csname nbfield\romannumeral\c@i\endcsname}
  \global\tableauhead=\expandafter{\currentheader}%
  \ifnum \c@i = \c@nbfields
    \global\tableauhead=\expandafter{\the\tableauhead\\ \hline\endhead}%
  \else
    \global\tableauhead=\expandafter{\the\tableauhead & }%
  \fi
  \unless\ifnum \c@i = \c@nbfields
  \repeat
}




\def\computetableaubody{%
  \c@i 0\relax
  \global\tableaubody={}
  \immediate\write10{tito}%
  \loop{ 
    \ifnum\c@i < \c@candnum
       \advance\c@i 1\relax 
       \c@j 0\relax
       \loop
          \advance\c@j 1\relax
          \edef
             \currentfield
                 {\csname nbfield\romannumeral\c@j\endcsname}
          \edef
              \currentfield
                  {\csname\currentfield\romannumeral\c@i\endcsname}
          \edef
             \currentfield
                 {\the\tableaubody \currentfield}
          \global\tableaubody=\expandafter{\currentfield}%
          \ifnum\c@j = \c@nbfields
              \global\tableaubody=\expandafter{\the\tableaubody \\\hline}%
          \else
              \global\tableaubody=\expandafter{\the\tableaubody & }
          \fi
          \immediate\write10{column parsed}%
      \unless\ifnum\c@j = \c@nbfields \repeat
      \immediate\write10{record  parsed}%
  }\repeat 
  \immediate\write10{finished parsing records}%
}





\def\tableau#1{%
  \newpage
  \immediate\write10{toto}%
  \computetableauhead
  \immediate\write10{toto}%
  \computetableaubody
  \begin{landscape}
  \immediate\write10{toto}%
  \centering
  \begin{longtable}{\the\tableaudescription}
    \the\tableauhead
    \the\tableaubody
    \caption{\large\sc\hbox{\vbox to 1cm{}} #1}
  \end{longtable}
  \end{landscape}
  \tableur@init
}

% Usage:
%\newfield{Nom}{l}
%\newfield{Laboratoire}{l}
%\newfield{Formation}{l}
%\newfield{Rang}{l}
%\newfield{Moyenne}{l}
%\newfield{Remarques}{p{6cm}}
%\newfield{Audition}{p{6cm}}
% \record
% \Nom{Balbiani}
% \Laboratoire{Irit}
% ...
% \tableau{R{\'e}sum{\'e} des candidatures}

